---
import Layout from "../../layouts/Layout.astro";

const lang = "zh";
---

<Layout
    title="MQTTåè®®æ–‡æ¡£ - å®œå¯æ™ºæ§Pro"
    description="å®œå¯æ™ºæ§Pro MQTTåè®®è¯¦è§£ï¼ŒåŒ…æ‹¬æ•°æ®ä¸ŠæŠ¥æ ¼å¼ã€æ§åˆ¶å‘½ä»¤ã€JSONæŠ¥æ–‡ç¤ºä¾‹ç­‰å®Œæ•´æŠ€æœ¯æ–‡æ¡£"
    lang={lang}
>
    <div class="page-header">
        <div class="container">
            <h1 class="page-title">MQTTåè®®æ–‡æ¡£</h1>
            <p class="page-subtitle">
                é€šè¿‡MQTTåè®®å®ç°è®¾å¤‡è¿œç¨‹æ§åˆ¶ä¸æ•°æ®é‡‡é›†ï¼Œå¯¹æ¥å„ç±»ç‰©è”ç½‘å¹³å°
            </p>
        </div>
    </div>

    <div class="content-wrapper">
        <nav class="sidebar">
            <h3 class="sidebar-title">ç›®å½•</h3>
            <ul class="sidebar-nav">
                <li><a href="#overview">åè®®æ¦‚è¿°</a></li>
                <li><a href="#report">æ•°æ®ä¸ŠæŠ¥æ ¼å¼</a></li>
                <li><a href="#control">æ§åˆ¶å‘½ä»¤</a></li>
                <li><a href="#switch">å¼€å…³æ§åˆ¶</a></li>
                <li><a href="#pwm">PWMæ§åˆ¶</a></li>
                <li><a href="#counter">è®¡æ•°å™¨æ§åˆ¶</a></li>
                <li><a href="#task">ä»»åŠ¡æ§åˆ¶</a></li>
                <li><a href="#system">ç³»ç»Ÿå‘½ä»¤</a></li>
                <li><a href="#ota">OTAå‡çº§</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <!-- Overview -->
            <section id="overview" class="doc-section">
                <h2>åè®®æ¦‚è¿°</h2>
                <p>
                    å®œå¯æ™ºæ§Proæ”¯æŒæ ‡å‡†MQTTåè®®ï¼Œå¯å¯¹æ¥ä»»æ„MQTT Brokerï¼ŒåŒ…æ‹¬ï¼š
                </p>
                <ul class="feature-list">
                    <li>é˜¿é‡Œäº‘IoTã€è…¾è®¯äº‘IoT</li>
                    <li>å·´æ³•äº‘ã€ThingsCloudã€ThingsBoard</li>
                    <li>Home Assistantã€EMQX</li>
                    <li>è‡ªå»ºç§æœ‰MQTTæœåŠ¡å™¨</li>
                </ul>

                <div class="info-card">
                    <h4>ğŸ“Œ è®¾å¤‡å‘½åè§„åˆ™</h4>
                    <p>è®¾å¤‡åæ ¼å¼ï¼š<code>yq_MainId_subId</code></p>
                    <ul>
                        <li><code>yq</code>ï¼šå›ºå®šå‰ç¼€</li>
                        <li><code>MainId</code>ï¼š16è¿›åˆ¶è®¾å¤‡ID</li>
                        <li><code>subId</code>ï¼š16è¿›åˆ¶Meshå­è®¾å¤‡ID</li>
                    </ul>
                    <p>
                        ç¤ºä¾‹ï¼š<code>yq_123456_22222</code> è¡¨ç¤ºä¸»è®¾å¤‡123456çš„å­è®¾å¤‡22222
                    </p>
                </div>
            </section>

            <!-- Data Report -->
            <section id="report" class="doc-section">
                <h2>æ•°æ®ä¸ŠæŠ¥æ ¼å¼</h2>
                <p>è®¾å¤‡ä¸»åŠ¨ä¸ŠæŠ¥æ•°æ®é‡‡ç”¨JSONæ ¼å¼ï¼Œå„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š</p>

                <div class="code-block">
                    <pre><code>{`{
  "yq_123456_0": [{
    "o": [states, size],      // å¼€å…³è¾“å‡ºçŠ¶æ€
    "p": [onoffs, inverses, p0, h0, pr0, hr0, ...],  // PWMçŠ¶æ€
    "i": [onoffs, pulse0, hz0, ...],  // è¾“å…¥çŠ¶æ€
    "t": [t1, t2, humidity],  // æ¸©æ¹¿åº¦
    "a": [a1, a2, a3],        // ADCæ¨¡æ‹Ÿé‡
    "c": [c1, c2, ..., c16],  // è®¡æ•°å™¨
    "r": rfValue,             // 433MHzæ¥æ”¶ä¿¡å·
    "s": states,              // è®¾å¤‡çŠ¶æ€
    "v": [FrameworkVer, UserBinVer, DriverVer]  // ç‰ˆæœ¬å·
  }]
}`}</code></pre>
                </div>

                <h3>å­—æ®µè¯¦è§£</h3>
                <table class="spec-table">
                    <thead>
                        <tr>
                            <th>å­—æ®µ</th>
                            <th>ç±»å‹</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>o</code></td>
                            <td>Array</td>
                            <td
                                >å¼€å…³è¾“å‡ºçŠ¶æ€ï¼Œstatesä¸ºUInt16ä½æ©ç ï¼Œsizeä¸ºè¾“å‡ºè·¯æ•°</td
                            >
                        </tr>
                        <tr>
                            <td><code>p</code></td>
                            <td>Array</td>
                            <td
                                >PWMçŠ¶æ€ï¼ŒåŒ…å«å¼€å…³ã€åå‘ã€å ç©ºæ¯”(Ã—100)ã€é¢‘ç‡ã€åŠ å‡é€Ÿç‡</td
                            >
                        </tr>
                        <tr>
                            <td><code>i</code></td>
                            <td>Array</td>
                            <td>è¾“å…¥çŠ¶æ€ï¼ŒåŒ…å«å¼€å…³çŠ¶æ€ã€è„‰å†²è®¡æ•°ã€é¢‘ç‡å€¼</td>
                        </tr>
                        <tr>
                            <td><code>t</code></td>
                            <td>Array</td>
                            <td>æ¸©åº¦1ã€æ¸©åº¦2(Int16)ã€æ¹¿åº¦</td>
                        </tr>
                        <tr>
                            <td><code>a</code></td>
                            <td>Array</td>
                            <td>ADCæ˜ å°„å€¼(Ã—100)ï¼ŒInt32</td>
                        </tr>
                        <tr>
                            <td><code>c</code></td>
                            <td>Array</td>
                            <td>16ä¸ªè®¡æ•°å™¨å€¼ï¼ŒInt32</td>
                        </tr>
                        <tr>
                            <td><code>r</code></td>
                            <td>UInt32</td>
                            <td>433MHzä¿¡å·ï¼Œä½4ä½ä¸ºæŒ‰é’®å€¼ï¼Œé«˜20ä½ä¸ºé¥æ§å™¨ID</td>
                        </tr>
                        <tr>
                            <td><code>v</code></td>
                            <td>Array</td>
                            <td>ç‰ˆæœ¬å·ï¼Œä»…é¦–æ¬¡è¿æ¥æ—¶ä¸ŠæŠ¥</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Control Commands -->
            <section id="control" class="doc-section">
                <h2>æ§åˆ¶å‘½ä»¤æ ¼å¼</h2>
                <p>ä¸‹å‘æ§åˆ¶å‘½ä»¤çš„JSONæ ¼å¼ï¼š</p>

                <h3>å•ä¸ªå‘½ä»¤</h3>
                <div class="code-block">
                    <pre><code>{`{
  "device": "yq_123456_0",
  "data": {
    "id": 1,
    "method": "so",
    "params": {}
  }
}`}</code></pre>
                </div>

                <h3>å¤šä¸ªå‘½ä»¤</h3>
                <div class="code-block">
                    <pre><code>{`{
  "device": "yq_123456_0",
  "data": [
    { "id": 1, "method": "so", "params": [228, 0] },
    { "id": 2, "method": "sp", "params": [0, 1, 0, 5000, 1000, 0, 0] }
  ]
}`}</code></pre>
                </div>
            </section>

            <!-- Switch Control -->
            <section id="switch" class="doc-section">
                <h2>å¼€å…³æ§åˆ¶ (so)</h2>
                <p>æ§åˆ¶ç»§ç”µå™¨å¼€å…³è¾“å‡ºçŠ¶æ€ã€‚</p>

                <div class="code-block">
                    <pre><code>{`"method": "so",
"params": [value0, value1]

// value0: å‰16ä¸ªå¼€å…³çš„æ§åˆ¶å€¼
// value1: 16-32å¼€å…³çš„æ§åˆ¶å€¼
// 2ä½å¯¹åº”1ä¸ªè¾“å‡º: 00=ä¸åŠ¨ä½œ, 01=å…³, 10=å¼€, 11=åˆ‡æ¢`}</code></pre>
                </div>

                <h3>ç¤ºä¾‹ï¼šæ§åˆ¶å‰4ä¸ªå¼€å…³</h3>
                <div class="code-block">
                    <pre><code>{`// value0 = 228 = 0b11100100
// å¼€å…³1: 00 = ä¸åŠ¨ä½œ
// å¼€å…³2: 01 = å…³é—­
// å¼€å…³3: 10 = æ‰“å¼€  
// å¼€å…³4: 11 = åˆ‡æ¢

"params": [228, 0]`}</code></pre>
                </div>
            </section>

            <!-- PWM Control -->
            <section id="pwm" class="doc-section">
                <h2>PWMæ§åˆ¶ (sp)</h2>
                <p>æ§åˆ¶PWMè¾“å‡ºçš„å ç©ºæ¯”ã€é¢‘ç‡åŠæ¸å˜é€Ÿç‡ã€‚</p>

                <div class="code-block">
                    <pre><code>{`"method": "sp",
"params": [idx, onoff, inverse, pwm, hz, pwmRate, hzRate]

// idx: PWMç´¢å¼• (0å¼€å§‹)
// onoff: 0=å…³, 1=å¼€, 2=åˆ‡æ¢
// inverse: 0=æ­£å‘, 1=åå‘
// pwm: å ç©ºæ¯” 0-10000 (å®é™…0-100.00%)
// hz: é¢‘ç‡ 1-100000Hz
// pwmRate: å ç©ºæ¯”æ¸å˜é€Ÿç‡ 0-10000/s
// hzRate: é¢‘ç‡æ¸å˜é€Ÿç‡ 0-100000Hz/s
// è®¾ä¸º-1è¡¨ç¤ºä¿æŒåŸå€¼`}</code></pre>
                </div>

                <h3>ç¤ºä¾‹ï¼šæ¸å˜è°ƒå…‰åˆ°50%</h3>
                <div class="code-block">
                    <pre><code>{`"method": "sp",
"params": [0, 1, 0, 5000, 1000, 100, 0]
// ç¬¬1è·¯PWM, æ‰“å¼€, æ­£å‘, 50%å ç©ºæ¯”, 1000Hz, æ¸å˜é€Ÿç‡1%/s`}</code></pre>
                </div>
            </section>

            <!-- Counter Control -->
            <section id="counter" class="doc-section">
                <h2>è®¡æ•°å™¨æ§åˆ¶ (sc)</h2>
                <p>è®¾ç½®æˆ–ä¿®æ”¹è®¡æ•°å™¨å€¼ã€‚</p>

                <div class="code-block">
                    <pre><code>{`"method": "sc",
"params": [idx, type, value, ...]

// idx: è®¡æ•°å™¨ç´¢å¼• 0-15
// type: 0=è®¾ç½®, 1=é€’å¢, 2=é€’å‡
// value: æ“ä½œå€¼`}</code></pre>
                </div>

                <h3>ç¤ºä¾‹</h3>
                <div class="code-block">
                    <pre><code>{`// å°†è®¡æ•°å™¨3é€’å¢10
"params": [2, 1, 10]`}</code></pre>
                </div>
            </section>

            <!-- Task Control -->
            <section id="task" class="doc-section">
                <h2>ä»»åŠ¡æ§åˆ¶</h2>

                <h3>æ‰§è¡Œä¸€é”®æ‰§è¡Œ (ro)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "ro",
"params": id  // ä»»åŠ¡ID`}</code></pre>
                </div>

                <h3>å¯ç”¨/ç¦ç”¨ä»»åŠ¡ (se)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "se",
"params": [id, enable]  // enable: 0=ç¦ç”¨, 1=å¯ç”¨`}</code></pre>
                </div>

                <h3>ä¸­æ­¢å»¶æ—¶ä»»åŠ¡ (sd)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "sd",
"params": id  // ä»»åŠ¡ID`}</code></pre>
                </div>

                <h3>è·å–æ•°æ® (gd)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "gd",
"params": dataType
// 0: åŸºæœ¬æ•°æ®(å¼€å…³ã€PWMã€è¾“å…¥ã€æ¸©æ¹¿åº¦ã€ADCã€è®¡æ•°å™¨)`}</code></pre>
                </div>
            </section>

            <!-- System Commands -->
            <section id="system" class="doc-section">
                <h2>ç³»ç»Ÿå‘½ä»¤</h2>

                <h3>é‡å¯è®¾å¤‡ (rb)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "rb",
"params": 1`}</code></pre>
                </div>

                <h3>è®¾ç½®å¯†ç  (sk)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "sk",
"params": [admin, user]
// è®¾ä¸º0åˆ™æ¸…é™¤å¯†ç `}</code></pre>
                </div>

                <h3>æ¸…é™¤è„‰å†²è®¡æ•° (cp)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "cp",
"params": idx  // è¾“å…¥ç´¢å¼•`}</code></pre>
                </div>

                <h3>å‘é€433MHzä¿¡å· (sr)</h3>
                <div class="code-block">
                    <pre><code>{`"method": "sr",
"params": [idx, rfValue]
// idx: é¥æ§å™¨ç´¢å¼• 0-9ç¡¬ä»¶, 10-19å­¦ä¹ åˆ°çš„
// idx=-1æ—¶rfValueåŒ…å«å®Œæ•´é¥æ§å™¨ä¿¡æ¯`}</code></pre>
                </div>
            </section>

            <!-- OTA -->
            <section id="ota" class="doc-section">
                <h2>OTAè¿œç¨‹å‡çº§ (ot)</h2>
                <div class="info-card warning">
                    <h4>âš ï¸ æ³¨æ„äº‹é¡¹</h4>
                    <ul>
                        <li>å‡çº§æˆåŠŸåè®¾å¤‡è‡ªåŠ¨é‡å¯</li>
                        <li>ç¡®ä¿å›ºä»¶æ­£ç¡®ç¨³å®šï¼Œå¦åˆ™å¯èƒ½æ­»æœº</li>
                        <li>ç¡®ä¿ç½‘ç»œå’Œä¾›ç”µç¨³å®š</li>
                    </ul>
                </div>

                <div class="code-block">
                    <pre><code>{`"method": "ot",
"params": [binType, url, wifiName, wifiPsw]

// binType: "0"=Framework, "1"=ç”¨æˆ·é€»è¾‘, "2"=ç”¨æˆ·é€»è¾‘(æ°¸ä¹…), "3"=é©±åŠ¨
// url: å›ºä»¶ä¸‹è½½åœ°å€
// wifiName/wifiPsw: è®¾å¤‡WiFiä¿¡æ¯`}</code></pre>
                </div>

                <p>å¯é€šè¿‡ä¸ŠæŠ¥çš„ <code>v</code> å­—æ®µéªŒè¯å‡çº§æ˜¯å¦æˆåŠŸã€‚</p>
            </section>

            <div class="cta-box">
                <p>éœ€è¦æ¥å…¥ç‰©è”ç½‘å¹³å°ï¼Ÿ</p>
                <a href="/zh/tutorials" class="btn btn-primary"
                    >æŸ¥çœ‹å¹³å°æ¥å…¥æ•™ç¨‹ â†’</a
                >
            </div>
        </main>
    </div>
</Layout>

<style>
    .page-header {
        background: var(--bg-light);
        color: var(--text-dark);
        padding: 1.25rem 1.5rem;
        text-align: center;
        border-bottom: 1px solid var(--border-light);
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0 0 1rem;
    }

    .page-subtitle {
        font-size: 1.25rem;
        opacity: 0.9;
        margin: 0;
    }

    .content-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 3rem;
        padding: 3rem 1.5rem;
    }

    @media (max-width: 1024px) {
        .content-wrapper {
            grid-template-columns: 1fr;
        }
    }

    /* Sidebar */
    .sidebar {
        position: sticky;
        top: 80px;
        height: fit-content;
    }

    @media (max-width: 1024px) {
        .sidebar {
            position: static;
        }
    }

    .sidebar-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 1rem;
    }

    .sidebar-nav {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar-nav li {
        margin-bottom: 0.5rem;
    }

    .sidebar-nav a {
        display: block;
        padding: 0.5rem 1rem;
        color: var(--text-muted);
        text-decoration: none;
        border-radius: 6px;
        font-size: 0.95rem;
        transition: all 0.2s ease;
    }

    .sidebar-nav a:hover {
        color: var(--primary);
        background: var(--primary-light);
    }

    /* Main Content */
    .main-content {
        min-width: 0;
    }

    .doc-section {
        margin-bottom: 4rem;
    }

    .doc-section h2 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0 0 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--primary-light);
    }

    .doc-section h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-dark);
        margin: 2rem 0 1rem;
    }

    .doc-section p {
        color: var(--text-muted);
        line-height: 1.7;
        margin: 0 0 1rem;
    }

    /* Code Blocks */
    .code-block {
        background: #1e293b;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        overflow-x: auto;
    }

    .code-block pre {
        margin: 0;
    }

    .code-block code {
        color: #e2e8f0;
        font-family: "Cascadia Code", "Fira Code", monospace;
        font-size: 0.9rem;
        line-height: 1.6;
    }

    /* Inline Code */
    p code,
    li code,
    td code {
        background: var(--primary-light);
        color: var(--primary-dark);
        padding: 0.125rem 0.375rem;
        border-radius: 4px;
        font-family: "Cascadia Code", "Fira Code", monospace;
        font-size: 0.875em;
    }

    /* Feature List */
    .feature-list {
        list-style: none;
        padding: 0;
        margin: 1rem 0;
    }

    .feature-list li {
        padding: 0.5rem 0 0.5rem 1.5rem;
        position: relative;
        color: var(--text-muted);
    }

    .feature-list li::before {
        content: "âœ“";
        position: absolute;
        left: 0;
        color: var(--primary);
        font-weight: 600;
    }

    /* Info Cards */
    .info-card {
        background: var(--bg-light);
        padding: 1.5rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        border-left: 4px solid var(--primary);
    }

    .info-card h4 {
        margin: 0 0 0.75rem;
        color: var(--text-dark);
    }

    .info-card p,
    .info-card li {
        color: var(--text-muted);
        margin: 0.5rem 0;
    }

    .info-card ul {
        padding-left: 1.25rem;
        margin: 0.5rem 0;
    }

    .info-card.warning {
        background: #fff7ed;
        border-left-color: #f97316;
    }

    .info-card.warning h4 {
        color: #c2410c;
    }

    .info-card.warning p,
    .info-card.warning li {
        color: #9a3412;
    }

    /* Tables */
    .spec-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        font-size: 0.95rem;
    }

    .spec-table th,
    .spec-table td {
        padding: 0.875rem 1rem;
        text-align: left;
        border-bottom: 1px solid var(--border-light);
    }

    .spec-table th {
        background: var(--bg-light);
        font-weight: 600;
        color: var(--text-dark);
    }

    .spec-table td {
        color: var(--text-muted);
    }

    /* CTA Box */
    .cta-box {
        background: linear-gradient(135deg, #f0f7ff 0%, #e6f0fa 100%);
        padding: 2rem;
        border-radius: 16px;
        text-align: center;
        margin-top: 2rem;
    }

    .cta-box p {
        font-size: 1.125rem;
        color: var(--text-dark);
        margin: 0 0 1rem;
    }

    .btn {
        display: inline-flex;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 10px;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .btn-primary {
        background: linear-gradient(
            135deg,
            var(--primary) 0%,
            var(--primary-dark) 100%
        );
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        color: white;
    }
</style>
